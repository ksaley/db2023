![image](https://github.com/ksaley/db2023/assets/70897569/55218e62-d5d5-4ea0-a9b0-ae752071b69b)

**YDB** — это распределённая отказоустойчивая Distributed SQL база данных с открытым исходным кодом, которая сочетает в себе высокую доступность и масштабируемость со строгой согласованностью и транзакциями ACID.
### История
В 2010 году внутри Яндекса началась разработка собственной NoSQL СУБД KiWi. Она начала использоваться в 2011 году. Однако KiWi обеспечивала «согласованность в конечном счёте» и обладала другими недостатками модели NoSQL.

В 2012 году началась внутренняя разработка проекта KiKiMR, и только для нужд Яндекса. За пределами компании проект назвали YDB. В 2016 году СУБД стала использоваться в сервисах Яндекса.

В 2018 году состоялся запуск облачной платформы Yandex Cloud, хранение данных в которой было основано на YDB. В то же время компания объявила, что в будущем сделает YDB доступной в Yandex Cloud в качестве управляемого сервиса. Позднее такой доступ действительно начал предоставляться наряду с другими управляемыми сервисами — для PostgreSQL, MongoDB и других. Эта облачная версия получила название Yandex Database (позднее — Managed service for YDB).

В апреле 2022 года СУБД YDB была опубликована на GitHub как свободное программное обеспечение под лицензией Apache 2.0. 

### Инструменты для взаимодействия
Для взаимодействия с YDB доступен YDB CLI, а также SDK для C++, C#, Go, Java, Node.js, PHP, Python и Rust.

### Язык запросов
Основным средством создания, модификации и управления данными в YDB является декларативный язык запросов YQL. YQL — это диалект SQL, который может считаться стандартом для общения с базами данных. Кроме того, YDB поддерживает набор специальных RPC, например, для работы с древовидной схемой или для управления кластером.

### На чем написана YDB
YDB написана на языке C++.

### Использование

Разворачиваем на кластере:
```
docker pull cr.yandex/yc/yandex-docker-local-ydb:latest
docker run -d --rm --name ydb-local -h localhost \
  -p 2135:2135 -p 2136:2136 -p 8765:8765 \
  -v $(pwd)/ydb_certs:/ydb_certs -v $(pwd)/ydb_data:/ydb_data \
  -e YDB_DEFAULT_LOG_LEVEL=NOTICE \
  -e GRPC_TLS_PORT=2135 -e GRPC_PORT=2136 -e MON_PORT=8765 \
  cr.yandex/yc/yandex-docker-local-ydb:latest
```
Устанавливаем YDB CLI:
```
curl -sSL https://storage.yandexcloud.net/yandexcloud-ydb/install.sh | bash
```
Сохраняем парматеры соединения с БД:
```
ydb config profile create quickstart --endpoint grpc://localhost:2136 --database /local
```
Создаем файл create-table.sql:
```
CREATE TABLE series (
    series_id Uint64 NOT NULL,
    title Utf8,
    series_info Utf8,
    release_date Date,
    PRIMARY KEY (series_id)
);
```
Создаем таблицу в базе:
```
ydb --profile quickstart yql --file create-table.sql
```





### Типы индексов

В YDB автоматически создается индекс по первичному ключу, поэтому выборки с условием по первичному ключу всегда выполняются эффективно, затрагивая только требуемые строки. Выборка с условием, наложенным на одну или несколько неключевых колонок, как правило, приводит к полному сканированию таблицы. Для того чтобы такие выборки были эффективными, нужно использовать вторичные индексы.

В текущей версии YDB реализованы синхронные и асинхронные глобальные вторичные индексы. Каждый индекс представляет собой скрытую таблицу, которая обновляется:
+ для синхронных индексов — транзакционно при изменении основной таблицы;
+ для асинхронных индексов — в фоне, получая необходимые изменения из основной таблицы.

Когда пользователь присылает SQL-запрос на вставку, изменение или удаление данных, БД прозрачно для пользователя формирует команды на изменение индексной таблицы. У таблицы может быть несколько вторичных индексов. Индекс может включать несколько колонок, при этом важен порядок указания колонок в индексе. Одна колонка может быть включена в нескольких индексов. В дополнение к указанным колонкам в индексе всегда неявно сохраняются значения колонок первичного ключа таблицы, чтобы от найденной записи в индексе можно было перейти к записи в таблице.

### Транзакции 
По умолчанию транзакции в YDB выполняются в режиме Serializable, который предоставляет самый строгий уровень изоляции для пользовательских транзакций. В этом режиме гарантируется, что результат успешно выполненных параллельных транзакций эквивалентен определенному последовательному порядку их выполнения, при этом для успешных транзакций отсутствуют аномалии чтений.

В случае, когда требования консистентности или свежести читаемых транзакцией данных могут быть ослаблены, пользователь имеет возможность использовать режимы выполнения с пониженными гарантиями:
+ Online Read-Only. Каждое из чтений в транзакции читает последние на момент своего выполнения данные. Консистентность полученных данных определяется настройкой allow_inconsistent_reads
+ Stale Read Only. Чтения данных в транзакции возвращают результаты с возможным отставанием от актуальных (доли секунды). Данные в каждом отдельно взятом чтении консистентны, между разными чтениями консистентность данных не гарантируется.

Режим выполнения транзакции задается в настройках транзакции при ее создании.


В YDB поддерживаются распределенные транзакции. Распределенные транзакции — это транзакции, которые затрагивают более одного шарда одной или нескольких таблиц. Они требуют больше ресурсов и выполняются дольше. В то время как точечные чтения и записи могут выполняться за время до 10 мс в 99 перцентиле, распределенные транзакции, как правило, занимают от 20 до 500 мс.


### Методы восстановления

Резервное копирование применяется для защиты от потери данных, позволяя восстановить их из резервной копии.

YDB предоставляет несколько решений для выполнения резервного копирования и восстановления:

    Резервное копирование в файлы и восстановление с помощью YDB CLI.
    Резервное копирование в S3-совместимое хранилище и восстановление с помощью YDB CLI.



### Шардинг
Таблица в YDB может быть шардирована по диапазонам значений первичного ключа. Различные шарды таблицы могут обслуживаться разными серверами распределенной БД (в том числе расположенными в разных локациях), а также могут независимо друг от друга перемещаться между серверами для перебалансировки или поддержания работоспособности шарда при отказах серверов или сетевого оборудования.

### Методы защиты
В YDB дополнительно реализовано шифрование на уровне баз данных. Данные шифруются непосредственно перед отправкой в Storage.
Пользователь Yandex Cloud может выполнять только те операции над ресурсами, которые разрешены назначенными ему ролями. Пока у пользователя нет никаких ролей, почти все операции ему запрещены.

### Сообщество СУБД
YDB развивается силами компании Яндекс, а также контрибьюторами на гитхабе https://github.com/ydb-platform/ydb/

![image](https://github.com/ksaley/db2023/assets/70897569/a377b10c-d8f8-42fa-87ce-ccaecacbd92b)

### Документация и обучение
https://ydb.tech/ru - официальный сайт, на котором представлена вся необходима информация и документация, а также информация об успешных кейсах использования 

https://github.com/ydb-platform/ydb/ - гитхаб с исходным кодом

### Как быть в курсе происходящего
https://blog.ydb.tech/ - блог, где выкладываются последние новоcти

https://t.me/ydb_ru -  русскоязычный комьюнити-чат 

### Промышленное использование

<img width="902" alt="image" src="https://github.com/ksaley/db2023/assets/70897569/6cc94fee-3e0e-454d-98ac-41065c0438af">




